@model Vapor.Models.Item

@{
    ViewData["Title"] = Model.Name;
    Review r = new Review();


    //var reviews = ViewData["Reviews"] as List<Review>;
    //SelectList itemsSelectList = reviews != null ? new SelectList(reviews, "Id", "Name") : null;
}
@using Vapor.Data
@{
    var shopcart = ViewBag.SCart as List<Item>;
    var wishlist = ViewBag.Wlist as List<Item>;

}
@{
    var reviews = ViewData["Reviews"] as List<Review>;

    var sale = Model.Sale * 100;
}   
<div class="card" style="background-color: #2C2F31">
    <div class="card-header">
        <h3>@Model.Name</h3>
    </div>


    <div class="card-body">
        <div class="row">
            <div class=" col-md-8">
                <div class="card" style="background-color: #2C2F31">
                    <div class="card-body">
                        <div id="carouselExampleIndicators" class="carousel slide carousel-fade" data-ride="carousel">
                            @*<ol class="carousel-indicators">
                                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
                            </ol>*@
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" src=@Model.Img2 alt="First slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src=@Model.Img3 alt="Second slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src=@Model.Img4 alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src=@Model.Img5 alt="Third slide">
                                </div>
                            </div>

                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                    <div class="card-footer">
                        @if (Model.Sale == 0)
                        {
                            <h3 class="">@Model.Price.ToString("c")</h3>
                        }
                        else
                        {
                            <p class="">
                                <a style="font-size:16px ;color:#4cff00; background-color:#1e6500">&nbsp-@sale%&nbsp</a>&nbsp
                                <s>@Model.Price.ToString("c")</s>
                            </p>
                            <h3 class="">@Model.SalePrice().ToString("c")</h3>

                        }
                        <div>
                            @if (Model.Id != shopcart.FirstOrDefault(m => m.Id == Model.Id)?.Id)
                            {
                                <a class=" btn btn-outline-danger" asp-controller="Items" asp-action="ToCart" asp-route-Id="@Model">Добавить в корзину</a>
                            }
                            else
                            {
                                <a class=" btn btn-outline-danger" asp-controller="Items" asp-action="ShopCart" asp-route-Id="@Model">Перейти к корзине</a>
                            }
                            @if (Model.Id != wishlist.FirstOrDefault(m => m.Id == Model.Id)?.Id)
                            {
                                <a class=" btn btn-outline-info" asp-controller="Items" asp-action="ToWlist" asp-route-Id="@Model">Добавить в желаемое</a>
                            }
                            else
                            {
                                <a class=" btn btn-outline-info" asp-controller="Items" asp-action="WishList" asp-route-Id="@Model">Перейти в желаемое</a>
                            }

                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-4">
                <div class="card" style="background-color: #2C2F31">
                    <img class="card-header" src=@Model.Img />
                    <div class="card-body">
                        <p class="text-center">
                            @Model.Description
                        </p>
                    </div>
                    <div class="card-footer text-center">
                        <a asp-controller="Items" asp-action="Index" asp-route-filterBy="@Model.Tag1" class="rounded" style="background: #008aff; color: white; ">&nbsp @Model.Tag1 &nbsp</a><br />
                        <a asp-controller="Items" asp-action="Index" asp-route-filterBy="@Model.Tag2" class="rounded" style="background: #008aff; color: white; ">&nbsp @Model.Tag2 &nbsp</a><br />
                        <a asp-controller="Items" asp-action="Index" asp-route-filterBy="@Model.Tag3" class="rounded" style="background: #008aff; color: white; ">&nbsp @Model.Tag3 &nbsp</a><br />

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        @if (User.IsInRole("Admin"))
        {
            <div>
                <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
                <a asp-action="Delete" asp-route-id="@Model.Id">Delete</a>
            </div>
        }
    </div>

</div>
<div class="card" style="background-color: #2C2F31">
    <h3 class="card-header">Оставить отзыв :</h3>
    <div class="card-body">
        <form asp-action="AddReview" asp-route-id="@Model.Id">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class="control-label">Текст</label>

                <textarea style="background-color: #2C2F31" class="form-control text-white" asp-for="@r.Text" id="exampleFormControlTextarea1" rows="3"></textarea>

                @*<input style="background-color: #181A1B" asp-for="@r.Text" class="form-control text-white" />*@
                <span asp-validation-for="@r.Text" class="text-danger"></span>
            </div>
            @*<div class="form-group">
                    <label class="control-label">Оценка</label>
                    <input style="background-color: #181A1B" asp-for="@r.Score" class="form-control text-white" />

                    <span asp-validation-for="@r.Score" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <input type="submit" value="Create" class="btn btn-primary" />
                </div>*@


        <div class="form-row align-items-center">
            <div class="col-auto my-1">
                <label class="mr-sm-2 sr-only" for="inlineFormCustomSelect">Preference</label>
                <select asp-for="@r.Score" class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                    @for (int i = 0; i <= 10; i++)
                    {
                        <option value="@i">@i/10</option>
                    }
                </select>
            </div>
            <div class="col-auto my-1">
                <button type="submit" class="btn btn-outline-info">Отправить отзыв</button>
            </div>
            <span asp-validation-for="@r.Text" class="text-danger"></span>
        </div>


        </form>
    </div>
</div>



<div class="card" style="background-color: #2C2F31">
    <h3 class="card-header">Все отзывы на @Model.Name :</h3>
    <table class="card-body table text-white">
        <thead>
            <tr>
                <th>
                    Текст
                </th>
                <th>
                    Оценка
                </th>
                <th>
                    Дата
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @{ if (reviews != null)
                    foreach (var rev in reviews)
                        if (rev.Item == Model)
                        {
                            <tr>
                                <td>
                                    @rev.Text
                                </td>
                                <td>
                                    @rev.Score/10
                                </td>
                                <td>
                                    @rev.Date
                                </td>
                            </tr>
                        }
            }
        </tbody>
    </table>
</div>



